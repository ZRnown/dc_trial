# Discord 体验会员机器人 - 使用说明

## 📋 机器人指令列表

### 👤 用户指令

#### 按钮功能（在体验申请面板中）
- **✨ 申请体验** - 点击申请体验会员权限
  - 每人仅限一次机会
  - 即使退出服务器重新加入也无法再次申请
  - 体验时长：2小时
  
- **⏰ 查询时长** - 点击查看剩余体验时间
  - 显示开始时间、到期时间和剩余时长

#### 斜杠命令
- `/help` - 显示所有可用指令的帮助信息
  - 在 Discord 中输入 `/` 即可看到命令提示

### 👑 管理员指令

- `/setup` - 发送体验权限申请面板
  - 需要管理员权限
  - 在 Discord 中输入 `/setup` 即可使用（有自动补全提示）
  - 面板包含「申请体验」和「查询时长」两个按钮

- `/checkall` - 查看所有体验用户信息
  - 需要管理员权限
  - 在 Discord 中输入 `/checkall` 即可使用（有自动补全提示）
  - 显示所有已申请体验的用户列表
  - 包括用户名、开始时间、剩余时间等信息

## 🚀 快速开始

### 1. 发送体验申请面板

在 Discord 服务器中，管理员输入：
```
/setup
```

**提示**：输入 `/` 后，Discord 会自动显示可用的斜杠命令列表，选择 `setup` 即可。这样就不需要记住命令了！

这会发送一个包含以下内容的嵌入消息：
- ✨ 体验权限申请标题
- ⚠️ 注意事项说明
- ⏰ 体验时长信息
- 两个按钮：「申请体验」和「查询时长」

### 2. 用户申请体验

用户点击面板上的 **「申请体验」** 按钮：
- 如果用户已经使用过体验机会，会提示"您已经使用过体验机会了"
- 如果用户正在体验中，会显示剩余时间
- 如果用户是第一次申请，会立即赋予会员身份组

### 3. 用户查询时长

用户点击面板上的 **「查询时长」** 按钮：
- 显示开始时间
- 显示到期时间
- 显示剩余时长（小时、分钟、秒）

## 🔒 安全机制

### 每人仅限一次机会

机器人使用数据库记录每个用户的体验状态：
- **用户ID**：Discord 用户唯一ID（不会因退出服务器而改变）
- **使用状态**：标记是否已使用过体验机会
- **开始时间**：体验开始的时间戳

**重要特性**：
- ✅ 即使用户退出服务器，记录也会保留
- ✅ 用户重新加入服务器后，无法再次申请
- ✅ 基于 Discord 用户ID，无法通过重新加入绕过限制

### 自动移除过期权限

机器人每分钟自动检查一次：
- 检查所有体验用户的剩余时间
- 自动移除已过期的会员身份组
- 记录保留在数据库中（用于防止重复申请）

## 📊 数据库结构

数据库文件：`vip_experience.db`

表结构：`user_experience`
- `user_id` (INTEGER PRIMARY KEY) - Discord 用户ID
- `start_time` (TEXT) - 体验开始时间（ISO格式）
- `used` (INTEGER) - 是否已使用（1=已使用，0=未使用）

## ⚙️ 配置说明

在 `.env` 文件中配置：
- `DISCORD_TOKEN` - Discord 机器人 Token
- `GUILD_ID` - Discord 服务器 ID
- `VIP_ROLE_ID` - 会员身份组 ID

## 💡 使用示例

### 场景1：新用户申请体验
1. 用户看到体验申请面板
2. 点击「申请体验」按钮
3. 机器人赋予会员身份组
4. 用户收到确认消息，显示到期时间

### 场景2：用户查询剩余时间
1. 用户点击「查询时长」按钮
2. 机器人显示剩余体验时间
3. 用户可以看到详细的开始和到期时间

### 场景3：用户尝试重复申请
1. 用户点击「申请体验」按钮
2. 机器人检测到用户已使用过体验机会
3. 显示错误消息："您已经使用过体验机会了"

### 场景4：体验时间到期
1. 定时任务检测到用户体验时间已过期
2. 自动移除用户的会员身份组
3. 用户记录保留在数据库中（防止重复申请）

## 🔧 故障排除

### 按钮无响应
- 检查机器人是否在线
- 检查控制台是否有错误信息
- 确认机器人有发送消息的权限

### 无法赋予身份组
- 确保机器人的身份组在服务器身份组列表中位于会员身份组之上
- 确保机器人有"管理身份组"权限
- 检查 `VIP_ROLE_ID` 配置是否正确

### 用户无法申请
- 检查用户是否已经使用过体验机会
- 查看数据库记录确认用户状态
- 使用 `!checkall` 命令查看所有用户信息

