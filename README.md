# Discord 体验会员申请机器人

这是一个 Discord 机器人，用于管理会员体验权限申请。

## 功能特性

- ✨ 体验权限申请：用户可以通过按钮申请体验会员权限
- ⏰ 查询时长：用户可以查询剩余体验时间
- 🔄 自动移除：体验时间结束后自动移除身份组
- 📊 管理员查询：管理员可以查看所有体验用户信息

## 安装步骤

1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 配置环境变量：
   - 复制 `.env.example` 为 `.env`
   - 填写以下信息：
     - `DISCORD_TOKEN`: 你的 Discord 机器人 Token
     - `GUILD_ID`: Discord 服务器 ID
     - `VIP_ROLE_ID`: 会员身份组 ID

3. 获取 Discord 机器人 Token：
   - 访问 https://discord.com/developers/applications
   - 创建新应用或选择现有应用
   - 在 "Bot" 页面创建机器人并复制 Token

4. 获取服务器 ID 和身份组 ID：
   - 在 Discord 中启用开发者模式
   - 右键点击服务器 → 复制服务器 ID
   - 右键点击身份组 → 复制身份组 ID

5. 邀请机器人到服务器：
   - 在 Discord 开发者门户中，选择你的应用
   - 进入 "OAuth2" → "URL Generator"
   - 选择 `bot` 和 `applications.commands` 权限
   - 选择以下权限：
     - Manage Roles（管理身份组）
     - Send Messages（发送消息）
     - Use Slash Commands（使用斜杠命令）
   - 复制生成的 URL 并在浏览器中打开，邀请机器人到服务器

6. 运行机器人：
```bash
python bot.py
```

## 使用方法

### 发送体验申请消息

在 Discord 服务器中使用以下斜杠命令（需要管理员权限）：
```
/setup
```

**提示**：输入 `/` 后，Discord 会自动显示可用的斜杠命令列表，选择 `setup` 即可。这样就不需要记住命令了！

这会发送一条包含"申请体验"和"查询时长"按钮的消息。

### 用户操作

- **申请体验**：点击"申请体验"按钮，机器人会自动赋予会员身份组
- **查询时长**：点击"查询时长"按钮，查看剩余体验时间

### 可用斜杠命令

#### 用户命令
- `/help` - 显示所有可用指令的帮助信息

#### 管理员命令
- `/setup` - 发送体验权限申请面板（需要管理员权限）
- `/checkall` - 查看所有体验用户的信息（需要管理员权限）

**提示**：在 Discord 中输入 `/` 即可看到所有可用的斜杠命令，并带有自动补全提示！

## 注意事项

- 每个用户只能获得一次体验机会
- 体验时长为 2 小时（可在代码中修改 `EXPERIENCE_DURATION_HOURS`）
- 体验时间结束后，权限会自动移除
- 机器人需要"管理身份组"权限才能正常工作

## 数据库

机器人使用 SQLite 数据库 (`vip_experience.db`) 存储用户信息：
- `user_id`: 用户 ID
- `start_time`: 体验开始时间
- `used`: 是否已使用过体验机会（1=已使用，0=未使用）

## 故障排除

1. **机器人无法赋予身份组**：
   - 确保机器人的身份组在服务器身份组列表中位于要赋予的身份组之上
   - 确保机器人有"管理身份组"权限

2. **按钮无响应**：
   - 确保机器人已正确启动
   - 检查控制台是否有错误信息

3. **权限未自动移除**：
   - 检查定时任务是否正常运行
   - 查看控制台日志

# dc_trial
